## 内存性能分析6.7-6.14
1. 虚拟内存的概念。
2. buff/cache的区别。
3. 内存泄漏的处理。
4. swap内存。
### 虚拟内存
1. 每个进程的寻址范围都是0-N(G)，这个内存地址空间称为虚拟内存，并不是通过设备管理看到的实际的物理内存。
2. 按页管理内存。在Linux中，内存按页进行管理，通常是4KB对应一页。
3. 进程使用的内存通过malloc等系统调用分配，在分配时，只是扩张了虚拟内存的地址空间，并没有实际分配。
4. 当进程寻址时，先通过页表找到虚拟内存映射的物理内存页。再访问物理内存也。
### buff/cache
1. buff指的是磁盘数据的缓存，cache指的是文件系统的文件数据缓存。
2. 磁盘的访问通常是访问文件系统，文件系统发现要访问的文件不在内存的cache中时，加载磁盘中的数据到内存中，进行缓存，称之为buff。
3. 文件系统的必要性。通过文件系统我们可以直接访问文件，不用关心具体有几个磁盘，磁盘中的数据是如何存储的。
4. 文件系统cache缓存的必要性。当文件系统加载文件数据到内存中时，通常近期还会访问该文件，因此有必要将文件缓存到内存中，称之为cache。
5. 磁盘buff缓存的必要性。磁盘分扇区，每块扇区固定大小，文件系统访问磁盘时，通常加载整块扇区的数据，因为通常情况下，该扇区近期仍会被访问，因此有必要将磁盘的这块扇区缓存到内存中，称之为buff。
6. 通过buff/cache访问磁盘的必要性。磁盘的访问速度是非常的慢的，远比内存访问慢，如果每次读写文件时都是直接去访问磁盘，则会导致CPU一直在等待IO。
7. buff/cache相关的性能分析。buff/cache相关的性能分析的一个重要标准是命中率，即文件读写时，文件缓存在内存中的概率，命中率越高，性能越高。
### 内存泄漏的处理
1. C/C++这种无自动GC的语言，通常需要手动GC，如果代码不够严谨，通常会导致内存只分配，未释放，这通常称之为内存泄漏。
2. 内存泄漏的处理。通常可以在编译程序时插入三方库，三方库会替换malloc等内存相关的函数，在分配内存时，增加一些冗余的信息来描述内存分配的情况。在程序退出时，或者主动扫描，查看是否有内存不被使用但未释放。
### swap内存
1. swap内存的原理。通常内存资源是固定的，由设备的硬件决定。在小内存的设备上，进程可食用的内存非常有限，稍不留意就可能OOM，此时可以考虑将内存中部分不常用的内存放到磁盘中，等需要时再从磁盘中加载出来。
2. swap的策略。swap内存需要将内存中的数据写到磁盘中，在需要时加载出来。因此swap的策略非常的重要，什么时候需要将内存中的数据缓存到磁盘中，缓存哪些数据到磁盘中。
